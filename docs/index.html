

<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Pyramid Game</title>
  <link rel="shortcut icon" type="image/x-icon" href="./logo.svg" id="favicon">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <meta name="description" content="">
  <meta name="keywords" content="pyramid game, pyramid, game, steviep, steve pikelny, pikelny, crypto, ethereum, eth, bitcoin, scam, pyramid scheme, scheme">

  <meta name="twitter:image" content="h">
  <meta name="twitter:image:alt" content="">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:creator" content="@steviepxyz">
  <meta name="twitter:site" content="@steviepxyz">
  <meta property="twitter:description" content="">

  <meta name="og:image" property="og:image" content="">
  <meta name="og:image:alt" content="">
  <meta property="og:type" content="website">
  <meta property="og:url" content="">
  <meta property="og:title" content="">
  <meta property="og:site_name" content="">
  <meta property="og:description" content="">


  <link rel="stylesheet" type="text/css" href="./styles.css">

  <style type="text/css">

    h1 {
      font-size: min(5em, 13vw);
      font-weight: 500;
    }

    h1, h2, h3 {
      text-align: center;
    }



    .slowBlink {
      animation: Blink 3s steps(2, start) infinite;
    }

    .mediumBlink {
      animation: Blink 1.5s steps(3, start) infinite;
    }

    #logo {
      width: 500px;
      max-width: 81vw;
    }

    button {
      background: var(--gray-color);
      color: var(--black-color);
      border: 0.15em solid var(--font-color);
      padding: 0.5em 1em;
      font-size: 2em;
      font-weight: 500;
      letter-spacing: 0.1em;
    }

    button:hover {
      color: var(--bg-color);
      background: var(--accent-color);
      border-color: var(--accent-color);
    }

    button:active {
      color: var(--font-color);
      border-color: var(--font-color);
      background: var(--bg-color);
    }

    .connectButton:hover {
      border-color: var(--font-color);
    }

    .center-v {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .center {
      display: flex;
      justify-content: center;
    }

    table {
      border: 2px solid;
      border-spacing: 0;
    }

    td, th {
      border: 1px solid;
      padding: 0.5em;
    }

    th {
      font-weight: 600;
    }

    section {
      margin: 2.5em auto;
      padding: 0 0.75em;
    }

    nav {
      background: var(--font-color);
      color: var(--bg-color);
      padding: 0.5em;
      display: flex;
      justify-content: space-evenly;
      font-size: 1.5em;
    }

    nav a {
      color: var(--bg-color);
    }
    nav a:hover {
      color: var(--accent-color);
    }

    @media(max-width: 740px) {
      nav {
        flex-direction: column;

      }
      nav > * {
        padding: 0.25em 0;
      }
      nav > a + a {
        border-top: 1px solid var(--bg-color);
      }
    }

    ul {
      font-weight: bolder;
      list-style: none;
      padding: 0;
      margin-left: 1.5em;
      font-size: 1em;

    }

    ul li {
      padding: 0.75em 0;
    }

    ul li::before {
      content: "▲";
      color: var(--font-color);
      display: inline-block;
      width: 1em;
      margin-left: -1em;
    }

    input {
      border: 3px solid var(--font-color);
      text-align: center;
      padding: 0.25em 0;
      font-size: 1.25em;
      background: var(--input-color);
    }

    input:active, input:focus, input:hover {
      outline: none;
      border-color: var(--accent-color);
    }

    input + .small-button {
      border-left: 0;
    }

    .small-button {
      font-size: 1.25em;
    }

    .tiny-button {
      font-size: 1em;
      margin-top: 0.25em;
    }
    .tiny-input {
      font-size: 1em;
      padding: 0.25em;
    }

    sup a {
      display: inline-block;
      border: 1px solid;
      text-decoration: none;
      color: var(--accent-color);
      padding: 0 0.25em;
      transform: translateY(-0.25em);
      margin-left: 0.25em;
      font-size: 0.75em;
    }

    sup a:hover {
      background: var(--accent-color);
      color: var(--accent-color);
      border-color: var(--accent-color);

      text-decoration: none;
    }

    a {
      text-decoration: none;
      color: var(--font-color);
    }

    a:hover {
      text-decoration: underline;
    }

    .scanlink-style {
      border-bottom: 0.1em solid rgba(0, 0, 0, 0);
      font-size: 1.75em;
    }

    .scanlink-style:hover {
      text-decoration: none;
      border-bottom: 0.1em solid;
    }

    .a-normal {
      text-decoration: underline;
    }
    .a-normal:hover {
      text-decoration: none;

    }

    .largeText {
      font-size: 6em;
    }
    @media (max-width:  640px) {
      .scanlink-style {
        font-size: 1.25em;
      }

    }

    @media (max-width:  550px) {
      .largeText {
        font-size: 3em;
      }

    }

    @media (max-width: 450px) {
      .scanlink-style {
        font-size: 0.9em;
      }
    }

    .contribution-row {
      border: 2px solid var(--font-color);
      padding: 1em;
      margin-bottom: 0.5em;
      line-height: 1.5;
      display: block;
      text-decoration: none;
      color: var(--font-color);
    }

    .contribution-row:hover {
      background: var(--font-color);
      color: var(--bg-color);
    }

    .contribution-row:hover .address {
      color: var(--bg-color);
    }

    .contribution-amount {
      font-weight: 600;
    }

    /* Small Leaders Grid */
    .small-leaders-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5em;
      max-width: 500px;
      width: 90vw;
      margin: 1em auto;
    }

    .small-leaders-grid leader-svg {
      width: 100%;
      max-width: 150px;
      margin: 0 auto;
      display: block;
    }

    leader-svg {
      border: 1px solid;
    }

    .small-leaders-grid .bordered {
      border: 1px solid var(--font-color);
    }

    @media (max-width: 580px) {
      .small-leaders-grid {
        grid-template-columns: repeat(3, 1fr);
        max-width: 400px;
      }
    }

    @media (max-width: 400px) {
      .small-leaders-grid {
        gap: 0.3em;
        max-width: 95vw;
      }
    }

    /* Grid Leaderboard Styles */
    .leaderboard-grid {
/*      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 0em;*/
      max-width: 1200px;
      margin: 2em auto;
      padding: 0 1em;
    }

    @media (max-width: 1110px) {
      .leaderboard-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    @media (max-width: 740px) {
      .leaderboard-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    /* Address display toggle */
    .addr-short {
      display: inline;
    }
    .addr-full {
      display: none;
    }

    @media (min-width: 701px) {
      .addr-short {
        display: none;
      }
      .addr-full {
        display: inline;
      }
    }


    #leaderboard-title {
      font-size: 3em;
    }

    @media (max-width:  530px) {
      #leaderboard-title {
        font-size: 2em;
      }
    }

    @media (max-width: 580px) {
      .leaderboard-grid {
        grid-template-columns: 1fr;
      }
    }

    .leader-card {
      border: 6px solid var(--font-color);
      border-top-width: 0;
      padding: 1em;
      /*flex-direction: column;*/
      /*background: var(--font-color);*/
      /*color: var(--bg-color);*/
    }
    .leader-card:first-child {
      border-top-width: 6px;
    }
    .leader-card h3 {
      text-align: left;
      margin-bottom: 0.25em;
    }

    .leader-card-content {
      display: flex;
      align-items: center;
      gap: 0.75em;

    }

    .leader-card .address {
      /*color: var(--bg-color);*/
    }

    .leader-card img,
    .leader-card leader-svg {
      width: 100%;
      max-width: 8.95em;
      height: auto;
      display: block;
    }

    @media (max-width: 510px) {
      .leader-card-content {
        flex-direction: column;
        align-items: center;
        font-size: 0.9em;
      }


      .leader-card h3 {
        font-size: 1em;
        text-align: center;
      }

      .leader-info {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .leader-info dd {
        text-align: center;
      }
    }





    .leader-info {
      width: 100%;
    }
    .leader-info h3 {
      text-align: left;
    }

    .leader-info > div {
      margin: 0.25em 0;
    }


    .leader-info dl {
      display: inline-flex;
      flex-direction: column;
      margin: 0.25em 0.5em;
      margin-left: 0;
    }

    .leader-info dt {
      font-size: 0.75em;
      background: var(--font-color);
      color: var(--bg-color);
      /*border:  1px solid;*/
      /*display: block;*/
      padding: 0.25em 0.5em;
      /*width: 100%;*/
    }

    .leader-info dd {
      /*width: 100%;*/
      border: 1px solid;
      padding: 0.25em 0.5em;
      /*display: block;*/
    }



    .section-box {
      border: 3px solid var(--font-color);
      padding: 1.5em;
      margin: 2em auto;
      max-width: 800px;
    }

    .token-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 1em;
      margin-top: 1em;
    }

    .token-item {
      border: 2px solid var(--font-color);
      padding: 0.5em;
      text-align: center;
    }

    .token-item img,
    .token-item leader-svg {
      width: 100%;
      max-width: 120px;
      display: block;
    }

    .erc20-controls {
      display: flex;
      flex-direction: column;
      gap: 1em;
      margin-top: 1em;
    }

    .control-row {
      display: flex;
      gap: 0.5em;
      align-items: center;
      flex-wrap: wrap;
    }

    .blinkSlow {
      animation: Blink 2s steps(2, start) infinite;
    }


  </style>


  <script src="./utils.js"></script>
  <!-- <script type="module" src="./modal.js"></script> -->
  <script type="module" src="./connectWallet.js"></script>




</head>
<body>
  <div class="center-v" style="margin: 2em 0">

    <svg id="logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 487 487" fill="none">
      <path d="M465.001 435.5H244.995H20.5L242.75 50L465.001 435.5Z"  stroke-width="14"/>
      <path d="M205.5 348C216 357 227.513 359.224 243.001 359.999C293 362.5 301.001 294.999 243.001 293.499C185.001 291.999 196.5 224.5 243.001 229.998C243.001 229.998 259.5 229.998 276.5 244"  stroke-width="14" stroke-linecap="square"/>
      <line x1="242.5" y1="201" x2="242.5" y2="386"  stroke-width="14"/>
    </svg>

    <h1>Pyramid Game</h1>
  </div>



  <connect-wallet>
    <div slot="connected">

      <section class="center-v">
        <div class="center">
          <input placeholder="0.01 Ξ" type="number" style="width:10.1em">  <button class="small-button">Send</button>
        </div>
      </section>

    </div>

    <div slot="notConnected">
      <div class="center" style="margin-top: 1em">
        <connect-button>
          <button class="connectButton" slot="button">CONNECT</button>
        </connect-button>
      </div>
    </div>
  </connect-wallet>




  </section>


  <section>
    <connect-wallet>
      <div slot="notConnected">
        <h1 class="slowBlink largeText" style="margin-bottom: 0.25em">$</h1>
      </div>
    </connect-wallet>

    <svg xmlns="http://www.w3.org/2000/svg" width="100%"  viewBox="0 0 1095 225" fill="none">
      <path d="M547 225L590.301 150L503.699 150L547 225ZM539.5 3.27835e-07L539.5 157.5L554.5 157.5L554.5 -3.27835e-07L539.5 3.27835e-07Z" fill="var(--font-color)"/>
    </svg>


    <h2 style="display: flex; align-items: center; justify-content: center; margin: 1em 0">
      <a class="scanlink scanlink-style">
        pyramidgame.eth<svg xmlns="http://www.w3.org/2000/svg" width="0.6em" viewBox="0 0 156 184" fill="none" style="margin-left: 0.25em; margin-top: 0em;">
          <rect x="6" y="6" width="144" height="172" stroke-width="23"/>
          <path d="M32 52H124" stroke-width="15"/>
          <path d="M32 92H124" stroke-width="15"/>
          <path d="M32 131H124" stroke-width="15"/>
        </svg>
      </a>
    </h2>


    <svg id="distribution-svg" xmlns="http://www.w3.org/2000/svg" width="100%" viewBox="0 0 1168 702" fill="none">
      <path d="M44 702L87.301 627H0.699L44 702ZM36.5 179L36.5 634.5H51.5L51.5 179H36.5Z" fill="var(--font-color)"/>
      <path d="M142 672L185.301 597H98.699L142 672ZM134.5 179L134.5 604.5H149.5L149.5 179H134.5Z" fill="var(--font-color)"/>
      <path d="M240 641L283.301 566H196.699L240 641ZM232.5 179L232.5 573.5H247.5L247.5 179H232.5Z" fill="var(--font-color)"/>
      <path d="M338 611L381.301 536H294.699L338 611ZM330.5 179L330.5 543.5H345.5L345.5 179H330.5Z" fill="var(--font-color)"/>
      <path d="M436 580L479.301 505H392.699L436 580ZM428.5 179L428.5 512.5H443.5L443.5 179H428.5Z" fill="var(--font-color)"/>
      <path d="M534 550L577.301 475H490.699L534 550ZM526.5 179L526.5 482.5H541.5L541.5 179H526.5Z" fill="var(--font-color)"/>
      <path d="M632 519L675.301 444H588.699L632 519ZM624.5 179L624.5 451.5H639.5L639.5 179H624.5Z" fill="var(--font-color)"/>
      <path d="M730 489L773.301 414H686.699L730 489ZM722.5 179L722.5 421.5H737.5L737.5 179H722.5Z" fill="var(--font-color)"/>
      <path d="M828 458L871.301 383H784.699L828 458ZM820.5 179L820.5 390.5H835.5L835.5 179H820.5Z" fill="var(--font-color)"/>
      <path d="M926 428L969.301 353H882.699L926 428ZM918.5 179L918.5 360.5H933.5L933.5 179H918.5Z" fill="var(--font-color)"/>
      <path d="M1024 397L1067.3 322H980.699L1024 397ZM1016.5 179L1016.5 329.5H1031.5L1031.5 179H1016.5Z" fill="var(--font-color)"/>
      <path d="M1122 367L1165.3 292H1078.7L1122 367ZM1114.5 179L1114.5 299.5H1129.5L1129.5 179H1114.5Z" fill="var(--font-color)"/>
      <line x1="36.5" y1="181.5" x2="1129.5" y2="181.5" stroke-width="15"/>
      <line x1="583" y1="-3.27835e-07" x2="583" y2="189" stroke-width="15"/>
    </svg>

    <div class="center-v">
      <!--
      <h2 style="font-size: 2.675em; margin-bottom: 0.25em;">Leaders <sup style="margin-left: -1em; font-size: 0.5em;"><a href="#faq">?</a></sup></h2>
      -->

      <div class="small-leaders-grid">
        <leader-svg svg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 576"><style>*{stroke:#000;fill:#46ff5a}</style><rect width="562" height="562" x="7" y="7" stroke-width="14"></rect><path d="M509.501 480H289.495H65L287.25 94.5L509.501 480Z" stroke-width="14"/><path d="M250 392.5C260.5 401.5 272.013 403.724 287.501 404.499C337.5 407 345.501 339.499 287.501 337.999C229.501 336.499 241 269 287.501 274.498C287.501 274.498 304 274.498 321 288.5" stroke-width="14" stroke-linecap="square"/><line x1="287" y1="245.5" x2="287" y2="430.5" stroke-width="14"/></svg>'></leader-svg>
        <leader-svg svg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 576"><style>*{stroke:#001cff;fill:#46ff5a}</style><rect width="562" height="562" x="7" y="7" stroke-width="14"></rect><path d="M509.501 480H289.495H65L287.25 94.5L509.501 480Z" stroke-width="14"/><path d="M250 392.5C260.5 401.5 272.013 403.724 287.501 404.499C337.5 407 345.501 339.499 287.501 337.999C229.501 336.499 241 269 287.501 274.498C287.501 274.498 304 274.498 321 288.5" stroke-width="14" stroke-linecap="square"/><line x1="287" y1="245.5" x2="287" y2="430.5" stroke-width="14"/></svg>'></leader-svg>
        <leader-svg svg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 576"><style>*{stroke:#ff1b1b;fill:#46ff5a}</style><rect width="562" height="562" x="7" y="7" stroke-width="14"></rect><path d="M509.501 480H289.495H65L287.25 94.5L509.501 480Z" stroke-width="14"/><path d="M250 392.5C260.5 401.5 272.013 403.724 287.501 404.499C337.5 407 345.501 339.499 287.501 337.999C229.501 336.499 241 269 287.501 274.498C287.501 274.498 304 274.498 321 288.5" stroke-width="14" stroke-linecap="square"/><line x1="287" y1="245.5" x2="287" y2="430.5" stroke-width="14"/></svg>'></leader-svg>
        <leader-svg svg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 576"><style>*{stroke:#001cff;fill:#000}</style><rect width="562" height="562" x="7" y="7" stroke-width="14"></rect><path d="M509.501 480H289.495H65L287.25 94.5L509.501 480Z" stroke-width="14"/><path d="M250 392.5C260.5 401.5 272.013 403.724 287.501 404.499C337.5 407 345.501 339.499 287.501 337.999C229.501 336.499 241 269 287.501 274.498C287.501 274.498 304 274.498 321 288.5" stroke-width="14" stroke-linecap="square"/><line x1="287" y1="245.5" x2="287" y2="430.5" stroke-width="14"/></svg>'></leader-svg>
        <leader-svg svg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 576"><style>*{stroke:#ff1b1b;fill:#000}</style><rect width="562" height="562" x="7" y="7" stroke-width="14"></rect><path d="M509.501 480H289.495H65L287.25 94.5L509.501 480Z" stroke-width="14"/><path d="M250 392.5C260.5 401.5 272.013 403.724 287.501 404.499C337.5 407 345.501 339.499 287.501 337.999C229.501 336.499 241 269 287.501 274.498C287.501 274.498 304 274.498 321 288.5" stroke-width="14" stroke-linecap="square"/><line x1="287" y1="245.5" x2="287" y2="430.5" stroke-width="14"/></svg>'></leader-svg>
        <leader-svg svg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 576"><style>*{stroke:#46ff5a;fill:#000}</style><rect width="562" height="562" x="7" y="7" stroke-width="14"></rect><path d="M509.501 480H289.495H65L287.25 94.5L509.501 480Z" stroke-width="14"/><path d="M250 392.5C260.5 401.5 272.013 403.724 287.501 404.499C337.5 407 345.501 339.499 287.501 337.999C229.501 336.499 241 269 287.501 274.498C287.501 274.498 304 274.498 321 288.5" stroke-width="14" stroke-linecap="square"/><line x1="287" y1="245.5" x2="287" y2="430.5" stroke-width="14"/></svg>'></leader-svg>
        <leader-svg svg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 576"><style>*{stroke:#ff1b1b;fill:#001cff}</style><rect width="562" height="562" x="7" y="7" stroke-width="14"></rect><path d="M509.501 480H289.495H65L287.25 94.5L509.501 480Z" stroke-width="14"/><path d="M250 392.5C260.5 401.5 272.013 403.724 287.501 404.499C337.5 407 345.501 339.499 287.501 337.999C229.501 336.499 241 269 287.501 274.498C287.501 274.498 304 274.498 321 288.5" stroke-width="14" stroke-linecap="square"/><line x1="287" y1="245.5" x2="287" y2="430.5" stroke-width="14"/></svg>'></leader-svg>
        <leader-svg svg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 576"><style>*{stroke:#46ff5a;fill:#001cff}</style><rect width="562" height="562" x="7" y="7" stroke-width="14"></rect><path d="M509.501 480H289.495H65L287.25 94.5L509.501 480Z" stroke-width="14"/><path d="M250 392.5C260.5 401.5 272.013 403.724 287.501 404.499C337.5 407 345.501 339.499 287.501 337.999C229.501 336.499 241 269 287.501 274.498C287.501 274.498 304 274.498 321 288.5" stroke-width="14" stroke-linecap="square"/><line x1="287" y1="245.5" x2="287" y2="430.5" stroke-width="14"/></svg>'></leader-svg>
        <leader-svg svg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 576"><style>*{stroke:#000;fill:#001cff}</style><rect width="562" height="562" x="7" y="7" stroke-width="14"></rect><path d="M509.501 480H289.495H65L287.25 94.5L509.501 480Z" stroke-width="14"/><path d="M250 392.5C260.5 401.5 272.013 403.724 287.501 404.499C337.5 407 345.501 339.499 287.501 337.999C229.501 336.499 241 269 287.501 274.498C287.501 274.498 304 274.498 321 288.5" stroke-width="14" stroke-linecap="square"/><line x1="287" y1="245.5" x2="287" y2="430.5" stroke-width="14"/></svg>'></leader-svg>
        <leader-svg svg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 576"><style>*{stroke:#46ff5a;fill:#ff1b1b}</style><rect width="562" height="562" x="7" y="7" stroke-width="14"></rect><path d="M509.501 480H289.495H65L287.25 94.5L509.501 480Z" stroke-width="14"/><path d="M250 392.5C260.5 401.5 272.013 403.724 287.501 404.499C337.5 407 345.501 339.499 287.501 337.999C229.501 336.499 241 269 287.501 274.498C287.501 274.498 304 274.498 321 288.5" stroke-width="14" stroke-linecap="square"/><line x1="287" y1="245.5" x2="287" y2="430.5" stroke-width="14"/></svg>'></leader-svg>
        <leader-svg svg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 576"><style>*{stroke:#000;fill:#ff1b1b}</style><rect width="562" height="562" x="7" y="7" stroke-width="14"></rect><path d="M509.501 480H289.495H65L287.25 94.5L509.501 480Z" stroke-width="14"/><path d="M250 392.5C260.5 401.5 272.013 403.724 287.501 404.499C337.5 407 345.501 339.499 287.501 337.999C229.501 336.499 241 269 287.501 274.498C287.501 274.498 304 274.498 321 288.5" stroke-width="14" stroke-linecap="square"/><line x1="287" y1="245.5" x2="287" y2="430.5" stroke-width="14"/></svg>'></leader-svg>
        <leader-svg svg='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 576"><style>*{stroke:#001cff;fill:#ff1b1b}</style><rect width="562" height="562" x="7" y="7" stroke-width="14"></rect><path d="M509.501 480H289.495H65L287.25 94.5L509.501 480Z" stroke-width="14"/><path d="M250 392.5C260.5 401.5 272.013 403.724 287.501 404.499C337.5 407 345.501 339.499 287.501 337.999C229.501 336.499 241 269 287.501 274.498C287.501 274.498 304 274.498 321 288.5" stroke-width="14" stroke-linecap="square"/><line x1="287" y1="245.5" x2="287" y2="430.5" stroke-width="14"/></svg>'></leader-svg>
      </div>
    </div>

    <div style="margin: 1em">
      <svg xmlns="http://www.w3.org/2000/svg" width="100%"  viewBox="0 0 1095 225" fill="none">
        <path d="M547 225L590.301 150L503.699 150L547 225ZM539.5 3.27835e-07L539.5 157.5L554.5 157.5L554.5 -3.27835e-07L539.5 3.27835e-07Z" fill="var(--font-color)"/>
      </svg>
    </div>

    <div style="margin: 4em 0; display: flex; justify-content: center;">
      <svg style="height: 100%; width: 220px; max-width: 27.5vw;" xmlns="http://www.w3.org/2000/svg" width="318" height="318" viewBox="0 0 318 318" fill="none">
        <path class="mediumBlink" style="animation-delay: 0s;" d="M317.241 228.479L317.241 141.876L242.242 185.178L317.241 228.479ZM187.494 3.75L180.999 7.5L276.996 173.772L283.491 170.022L289.987 166.272L193.989 6.70552e-07L187.494 3.75Z" fill="var(--font-color)"/>
        <path class="mediumBlink" style="animation-delay: -0.5s;" d="M136.243 3.75623L61.243 47.0575L136.243 90.3588L136.243 3.75623ZM6.49609 228.484L12.9913 232.234L108.988 65.9629L102.493 62.2129L95.9978 58.4629L0.000903785 224.734L6.49609 228.484Z" fill="var(--font-color)"/>
        <path class="mediumBlink" style="animation-delay: -1s;" d="M28.8927 274.615L103.893 317.916L103.893 231.314L28.8927 274.615ZM293.893 274.615V267.115L96.3927 267.115V274.615V282.115L293.893 282.115V274.615Z" fill="var(--font-color)"/>
      </svg>
    </div>

    <div style="margin: 1em">
      <svg xmlns="http://www.w3.org/2000/svg" width="100%"  viewBox="0 0 1095 225" fill="none">
        <path d="M547 225L590.301 150L503.699 150L547 225ZM539.5 3.27835e-07L539.5 157.5L554.5 157.5L554.5 -3.27835e-07L539.5 3.27835e-07Z" fill="var(--font-color)"/>
      </svg>
    </div>

    <h1 class="slowBlink">$</h1>
  </section>

<!--   <section style="display: flex; justify-content: center;">

    <ul>
      <li>Send ETH to <a class="scanlink a-normal">pyramidgame.eth</a></li>
      <li>Get on the <a href="#leaderboard">Leaderboard</a></li>
      <li>Receive future payouts<sup><a href="#disclaimer">*</a></sup></li>
    </ul>
  </section> -->


  <section>
    <nav>
      <a href="">Send ETH →</a>
      <a href="">View Leaderboard →</a>
      <a href="">Docs →</a>
    </nav>
  </section>

  <!-- 1. How It Works -->
  <section>
    <connect-wallet>
      <div slot="connected">
        <div id="howItWorksSection">
          <div class="section-box">
            <h2>How It Works</h2>
            <ul>
              <li>Pyramid Game uses cutting edge pyramid scheme technology to redistribute value between players.</li>
              <li>All ETH sent to Pyramid Game is split proportionally among the 12 <a href="#leaderboard" class="a-normal">Leaderboard</a> members based on their prior contributions.</li>
              <li>All Leaderboard positions are represented by NFTs, and all contributions from non-leaders are represented by the $PYRAMID token.</li>
            </ul>
            <a href="#docs" class="a-normal" style="margin-left: 1.5em;">Learn More →</a>
          </div>
        </div>
      </div>
    </connect-wallet>
  </section>

  <!-- 2. Send Input + Smart Messaging -->
  <section>
    <connect-wallet>
      <div slot="connected">
        <div id="sendEthSection" class="center-v" style="margin: 2em auto;"></div>
      </div>
    </connect-wallet>
  </section>

  <!-- 3. Leaderboard -->
  <section id="leaderboard">
    <div class="center-v">
      <connect-wallet>
        <div slot="connected">
          <h2 id="leaderboard-title">Leaderboard</h2>
          <div id="leaderboardStats" style="text-align: center; margin: 1.5em auto; font-size: 1.2em;"></div>
          <div id="leaderboard-board" class="leaderboard-grid"></div>
        </div>

        <div slot="notConnected">
          <div class="center" style="margin-top: 1em; border: 3px solid; padding: 1.5em">
            <connect-button>
              <button class="connectButton" slot="button" style="font-size: 1.5em">Connect to view<br> Leaderboard</button>
              <div slot="loading" class="slowBlink" style="font-size: 1.5em">Connecting...</div>
            </connect-button>
          </div>
        </div>
      </connect-wallet>
    </div>
  </section>

  <!-- 4. GET STARTED / Connected User Info -->
  <section>
    <connect-wallet>
      <div slot="notConnected" class="center-v" style="margin: 2em auto;">
        <h2>GET STARTED</h2>
        <connect-button>
          <button class="connectButton" slot="button" style="font-size: 1.5em;">Connect Wallet</button>
          <div slot="loading" class="slowBlink" style="font-size: 1.5em">Connecting...</div>
        </connect-button>
      </div>

      <div slot="connected" class="center-v" style="margin: 2em auto;">
        <div id="connectedUserInfo"></div>
      </div>
    </connect-wallet>
  </section>

  <!-- 5. User Section -->
  <section>
    <connect-wallet>
      <div slot="connected">
        <div id="userSection"></div>
      </div>
    </connect-wallet>
  </section>


  <section class="center-v" id="distributions">
    <h2>Latest Distributions</h2>
  </section>


  <section class="center-v" id="disclaimer">
    <p>All players of Pyramid Game understand that (a) only leaderboard members will receive a portion of Pyramid Game distributions, (b) all distribution amounts are determined by </p>
  </section>

  <footer style="margin: 4em auto;"><a href="https://steviep.xyz" target="_blank" style="text-decoration: underline;">steviep.xyz</a> 2025</footer>



<!--     <div class="block" style="background: var(--black-color); color: var(--red-color);">
      dsfasdfsadfasdfdasd
    </div>
    <div class="block" style="background: var(--gray-color); color: var(--green-color);">
      dsfasdfsadfasdfdasd
    </div>
    <div class="block" style="background: var(--white-color); color: var(--red-color);">
      dsfasdfsadfasdfdasd
    </div>
    <div class="block" style="background: var(--green-color); color: var(--black-color);">
      dsfasdfsadfasdfdasd
    </div>
    <div class="block" style="background: var(--cyan-color); color: var(--black-color);">
      dsfasdfsadfasdfdasd
    </div>
    <div class="block" style="background: var(--blue-color); color: var(--black-color);">
      dsfasdfsadfasdfdasd
    </div>
    <div class="block" style="background: var(--magenta-color); color: var(--black-color);">
      dsfasdfsadfasdfdasd
    </div>

    <div class="block" style="background: var(--red-color); color: var(--black-color);">
      dsfasdfsadfasdfdasd
    </div>


    <div class="block" style="background: var(--orange-color); color: var(--black-color);">
      dsfasdfsadfasdfdasd
    </div>

    <div class="block" style="background: var(--yellow-color); color: var(--black-color);">
      dsfasdfsadfasdfdasd
    </div>
 -->


</body>



<script type="module">
  import {provider, etherscanAddr, addEtherscanLinks, ethVal, txValue} from './eth.js'
  import {CONTRACTS} from './contracts.js'
  import {$} from './$.js'

  // Define leader-svg web component with isolated styles
  class LeaderSVG extends HTMLElement {
    constructor() {
      super()
      this.attachShadow({ mode: 'open' })
    }

    connectedCallback() {
      const svg = this.getAttribute('svg')
      if (svg) {
        this.shadowRoot.innerHTML = `
          <style>
            :host {
              display: block;
              width: 100%;
              height: auto;
            }
            svg {
              width: 100%;
              height: auto;
              display: block;
            }
          </style>
          ${svg}
        `
      }
    }
  }
  customElements.define('leader-svg', LeaderSVG)

  provider.setContractInfo(CONTRACTS)
  addEtherscanLinks('scanlink', 'PyramidGame')

  // Helper functions
  const utf8Clean = raw => raw.replace(/data.*utf8,/, '')
  const b64Clean = raw => raw.replace(/data.*,/, '')

  const extractSVG = jsonURI => {
    try {
      const imageDataURI = jsonURI.image
      const svgMarkup = atob(b64Clean(imageDataURI))
      return svgMarkup
    } catch (e) {
      console.error('Error extracting SVG:', e)
      return ''
    }
  }

  const timeAgo = timestamp => {
    const now = Date.now()
    const diff = Math.floor((now - timestamp) / 1000)

    if (diff < 60) return `${diff} second${diff === 1 ? '' : 's'} ago`
    if (diff < 3600) {
      const mins = Math.floor(diff / 60)
      return `${mins} minute${mins === 1 ? '' : 's'} ago`
    }
    if (diff < 86400) {
      const hours = Math.floor(diff / 3600)
      return `${hours} hour${hours === 1 ? '' : 's'} ago`
    }
    if (diff < 31536000) {
      const days = Math.floor(diff / 86400)
      return `${days} day${days === 1 ? '' : 's'} ago`
    }
    const years = Math.floor(diff / 31536000)
    return `${years} year${years === 1 ? '' : 's'} ago`
  }

  const calculateProjection = (sortedLeaders, contributionTotal) => (inputAmount) => {
    if (!inputAmount || inputAmount <= 0) return null
    return sortedLeaders.map(l => {
      const share = (inputAmount * l.contribution) / contributionTotal
      const percentage = (l.contribution / contributionTotal) * 100
      return { ...l, share: share, percentage: percentage }
    })
  }

  // Main render function
  async function renderPage(addr) {
    // === Fetch all data ===
    const { PyramidGame } = await provider.getContracts()
    const { name: chainName, etherscanLink } = await provider.getNetwork()

    const leadersAddr = await PyramidGame.leaders()
    const PyramidGameLeaders = await provider.contract(leadersAddr, CONTRACTS.PyramidGameLeaders.abi)

    const activeLeaderse = Number(await PyramidGameLeaders.totalSupply())
    const leaderContributionTotal = ethVal(await PyramidGameLeaders.contributionTotal())

    // Fetch all leader data
    const leaders = await Promise.all(times(activeLeaderse, async i => {
      const owner = await PyramidGameLeaders.ownerOf(i)
      const prettyAddrShort = await provider.formatAddr(owner)
      const prettyAddr = await provider.formatAddr(owner, false)
      const contribution = ethVal(await PyramidGameLeaders.contributions(i))
      const tokenURI = JSON.parse(utf8Clean(await PyramidGameLeaders.tokenURI(i)))
      const svg = extractSVG(tokenURI)
      const percentage = (contribution / leaderContributionTotal) * 100

      return {
        tokenId: i,
        tokenName: tokenURI.name,
        owner,
        prettyAddr,
        prettyAddrShort,
        contribution,
        svg,
        percentage
      }
    }))

    // Sort by contribution (highest first)
    const sortedLeaders = leaders.sort((a, b) => b.contribution - a.contribution)
    const lowestLeader = sortedLeaders[sortedLeaders.length - 1]

    // Calculate total contributions
    const pyramidTotalSupply = ethVal(await PyramidGame.totalSupply())
    const totalContributed = leaderContributionTotal + pyramidTotalSupply

    // Render stats
    $.id('leaderboardStats').innerHTML = `
      <div style="display: flex; justify-content: center; gap: 2em; flex-wrap: wrap;">
        <div><strong>Sent by Leaders:</strong> <span style="margin-right: 0.25em">Ξ</span>${leaderContributionTotal.toFixed(4)}</div>
        <div><strong>Total Sent:</strong> <span style="margin-right: 0.25em">Ξ</span>${totalContributed.toFixed(4)}</div>
      </div>
    `

    // Render leaderboard grid
    $.id('leaderboard-board').innerHTML = sortedLeaders.map(l => {
      const escapedSVG = l.svg.replace(/"/g, '&quot;')
      return `
        <div class="leader-card">
          <h3>${l.tokenName}</h3>
          <div class="leader-card-content">
            <leader-svg svg="${escapedSVG}" style="${[5,7,9].includes(l.tokenId) ? 'border: 1px solid' : ''}"></leader-svg>
            <div class="leader-info">
              <dl>
                <dt>OWNER</dt>
                <dd>
                  <span class="addr-short">${etherscanAddr(etherscanLink, l.owner, l.prettyAddrShort)}</span>
                  <span class="addr-full">${etherscanAddr(etherscanLink, l.owner, l.prettyAddr)}</span>
                </dd>
              </dl>
              <div>
                <dl>
                  <dt>SENT</dt>
                  <dd>
                    <span style="margin-right: 0.25em">Ξ</span><strong>${l.contribution.toFixed(4)}</strong>
                  </dd>
                </dl>
                <dl>
                  <dt>% OF NEXT PAYOUT</dt>
                  <dd>
                    <strong>${l.percentage.toFixed(2)}%</strong>
                  </dd>
                </dl>
              </div>
              <strong style="font-size: 0.75em"><a href="" target="_blank" rel="nofollow">View on OpenSea →</a></strong>
            </div>
          </div>
        </div>
      `
    }).join('')

    // Get user's tokens
    const userTokens = leaders.filter(l => l.owner.toLowerCase() === addr.toLowerCase())

    // Get user's ERC20 balance
    const erc20Balance = ethVal(await PyramidGame.balanceOf(addr))

    const userIsLeader = userTokens.length > 0
    const getProjection = calculateProjection(sortedLeaders, leaderContributionTotal)

    // === 2. Send ETH Section with Smart Messaging ===
    const prettyAddr = await provider.formatAddr(addr)
    $.id('sendEthSection').innerHTML = `
      <div style="text-align: center; margin-bottom: 1em;">
        <h3><strong>Connected as:</strong> ${prettyAddr}</h3>
        ${!userIsLeader ? `<p>Lowest Leaderboard contribution: <strong><span style="margin-right: 0.25em">Ξ</span>${lowestLeader.contribution.toFixed(4)}</strong></p>` : ''}
        ${erc20Balance > 0 ? `<p>Your $PYRAMID Balance: <strong>${erc20Balance.toFixed(4)}</strong></p>` : ''}
      </div>
      <div class="center">
        <input id="sendEthInput" placeholder="0.01 Ξ" type="number" step="0.01" style="width:10.1em">
        <button id="sendEthBtn" class="small-button">Send</button>
      </div>
      <div id="sendEthMessage" style="margin-top: 1em; max-width: 600px;"></div>
      <div id="sendEthError" class="error-message"></div>
    `

    const updateSendMessage = () => {
      const amount = parseFloat($.id('sendEthInput').value)
      if (!amount || amount <= 0) {
        $.id('sendEthMessage').innerHTML = ''
        return
      }

      const newErc20Balance = erc20Balance + amount

      let message = ''

      if (userIsLeader) {
        const userTotalContribution = userTokens.reduce((sum, t) => sum + t.contribution, 0)
        const newUserTotal = userTotalContribution + amount
        const newContributionTotal = leaderContributionTotal + amount
        const newPercentage = (newUserTotal / newContributionTotal) * 100
        message = `<p style="text-align: center">This transaction would increase your distribution payout to <strong>${newPercentage.toFixed(2)}%</strong>.</p>`
      } else {
        if (newErc20Balance > lowestLeader.contribution) {
          const newPercentage = (amount / (leaderContributionTotal + amount)) * 100
          message = `<p style="text-align: center"><strong>This transaction would give you a Leaderboard slot.</strong></p>
                    ${erc20Balance ? `<p style="text-align: center">(Your balance of <strong>${erc20Balance.toFixed(4)} $PYRAMID</strong> will burned)</p>` : ''}
                     <p style="text-align: center">You would receive <strong>${newPercentage.toFixed(2)}%</strong> of future payouts.</p>`
        } else {
          message = `<p style="text-align: center">This is not enough to enter the Leaderboard. You would need to send at least <strong><span style="margin-right: 0.25em">Ξ</span>${(lowestLeader.contribution + 0.0001 - erc20Balance).toFixed(4)}</strong>.</p> <p style="text-align: center">However, you would receive <strong>${amount.toFixed(4)} $PYRAMID</strong> from this transaction.</p>`
        }
      }

      message = `<div style="margin-top: 1.5em; margin-bottom: 3em">${message}</div>`

      // Add projection table with arrow
      const projection = getProjection(amount)
      message += `
        <div style="margin-top: 1em;">
          <p style="text-align: center"><strong>Your Ξ${amount} would be split ${activeLeaderse} ways:</strong></p>
          <div style="margin: 0.5em auto; width: 400px; max-width: 90vw;">
            ${projection.map((l, index) => `
              <div style="padding: 0.5em 0; ${index < projection.length - 1 ? 'border-bottom: 1px dashed;' : ''}">
                <div style="display: flex; align-items: center; gap: 0.25em; margin-bottom: 0.25em;">
                  <span style="display: inline-block; width: ${l.percentage}%; background: var(--font-color); height: 3px; border: 1px solid var(--font-color);"></span>
                  <span style="font-size: 0.6em;">${l.percentage.toFixed(1)}%</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 0.25em;">
                  <span><span style="margin-right: 0.25em">Ξ</span><strong>${l.share.toFixed(4)}</strong></span>
                  <span style="font-size: 1.5em; padding: 0 1em">→</span>
                  <span>${l.prettyAddrShort}</span>
                </div>
              </div>
            `).join('')}
          </div>
        </div>
      `

      $.id('sendEthMessage').innerHTML = message
    }

    $.id('sendEthInput').oninput = updateSendMessage

    $.id('sendEthBtn').onclick = async () => {
      $.id('sendEthMessage').innerHTML = ''
      const amount = parseFloat($.id('sendEthInput').value)
      if (!amount || amount <= 0) {
        $.id('sendEthError').innerHTML = 'Please enter a valid amount'
        return
      }

      $.id('sendEthError').innerHTML = 'Pending...'
      try {
        const tx = await PyramidGame.contribute(txValue(amount))
        $.id('sendEthError').innerHTML = `<span class="blinkSlow">TX Pending.</span> <a href="https://${etherscanLink}/tx/${tx.hash}" target="_blank" rel="nofollow">View on etherscan</a>`
        await tx.wait(1)
        renderPage(addr)
        $.id('sendEthError').innerHTML = 'Success!'
        setTimeout(() => {
          $.id('sendEthError').innerHTML = ''
        }, 2000)
      } catch (e) {
        $.id('sendEthError').innerHTML = e?.data?.message || e?.error?.message || e?.message || 'Something went wrong'
        console.error(e)
      }
    }

    // === 4. Connected User Info ===
    $.id('connectedUserInfo').innerHTML = `
      <div style="text-align: center;">
        ${userTokens.length > 0 ? `
          <p><strong>Leader tokens:</strong> ${userTokens.map(t => `#${t.tokenId}`).join(', ')}</p>
        ` : ''}
      </div>
    `

    // === 5. User Section ===
    let userSectionHTML = ''

    // If user IS a leader
    if (userIsLeader) {
      const userTotalContribution = userTokens.reduce((sum, t) => sum + t.contribution, 0)
      const userPercentage = (userTotalContribution / leaderContributionTotal) * 100

      userSectionHTML += `
        <div class="section-box">
          <h2>You Are a Leader!</h2>
          <p style="font-size: 1.5em;"><strong>You would receive ${userPercentage.toFixed(2)}%</strong> of future payouts</p>

          <h3 style="margin-top: 2em;">Your Leader Tokens</h3>
          <div class="token-grid">
            ${userTokens.map(t => {
              const escapedSVG = t.svg.replace(/"/g, '&quot;')
              return `
                <div class="token-item">
                  <leader-svg svg="${escapedSVG}"></leader-svg>
                  <div><strong>#${t.tokenId}</strong></div>
                  <div><span style="margin-right: 0.25em">Ξ</span>${t.contribution.toFixed(4)}</div>
                </div>
              `
            }).join('')}
          </div>

          ${erc20Balance > 0 ? `
            <div style="margin-top: 2em;">
              <h3>Add to Leader Contribution</h3>
              <p>You have ${erc20Balance.toFixed(4)} Ξ worth of $PYRAMID tokens</p>
              <div class="control-row">
                <input id="addContribTokenId" class="tiny-input" placeholder="Token ID" style="width: 8em;">
                <input id="addContribAmount" class="tiny-input" placeholder="Amount (Ξ)" style="width: 8em;">
                <button id="addContribBtn" class="tiny-button">Add to Balance</button>
              </div>
              <div id="addContribError" class="error-message"></div>
            </div>
          ` : ''}
        </div>
      `
    }

    // If user has ERC20 balance
    if (erc20Balance > 0) {
      const canClaimLeadership = erc20Balance > lowestLeader.contribution

      userSectionHTML += `
        <div class="section-box">
          <h2>$PYRAMID Tokens</h2>
          <p style="font-size: 1.5em; margin: 0.5em 0;"><strong>${erc20Balance.toFixed(4)} Ξ</strong> worth of $PYRAMID</p>

          ${canClaimLeadership ? `
            <div style="margin-top: 1.5em; padding: 1em; border: 2px solid var(--accent-color);">
              <h3>Claim Leadership!</h3>
              <p>You have enough $PYRAMID to claim a leader spot!</p>
              <button id="claimLeadershipBtn" class="tiny-button">Claim Leadership</button>
              <div id="claimError" class="error-message"></div>
            </div>
          ` : ''}

          <div style="margin-top: 1.5em;">
            <h3>Transfer $PYRAMID</h3>
            <div class="control-row">
              <input id="transferTo" class="tiny-input" placeholder="Recipient Address" style="width: 20em; max-width: 90vw;">
              <input id="transferAmount" class="tiny-input" placeholder="Amount (Ξ)" style="width: 8em;">
              <button id="transferBtn" class="tiny-button">Transfer</button>
            </div>
            <div id="transferError" class="error-message"></div>
          </div>

          <div style="margin-top: 1.5em;">
            <h3>Approve $PYRAMID</h3>
            <div class="control-row">
              <input id="approveSpender" class="tiny-input" placeholder="Spender Address" style="width: 20em; max-width: 90vw;">
              <input id="approveAmount" class="tiny-input" placeholder="Amount (Ξ)" style="width: 8em;">
              <button id="approveBtn" class="tiny-button">Approve</button>
            </div>
            <div id="approveError" class="error-message"></div>
          </div>
        </div>
      `
    }

    // Check if PG has ETH balance
    const pgBalance = ethVal(await provider.provider.getBalance(PyramidGame.address))
    if (pgBalance > 0) {
      userSectionHTML += `
        <div class="section-box">
          <h2>Force Distribution</h2>
          <p>Pyramid Game contract balance: <span style="margin-right: 0.25em">Ξ</span>${pgBalance.toFixed(4)}</p>
          <button id="forceDistributeBtn" class="tiny-button">Force Distribution</button>
          <div id="forceDistributeError" class="error-message"></div>
        </div>
      `
    }

    $.id('userSection').innerHTML = userSectionHTML

    // Wire up event handlers
    if (userIsLeader && erc20Balance > 0) {
      $.id('addContribBtn').onclick = async () => {
        $.id('addContribError').innerHTML = 'Pending...'
        try {
          const tokenId = Number($.id('addContribTokenId').value)
          const amount = parseFloat($.id('addContribAmount').value)
          const tokenAmount = Math.floor(amount)

          const tx = await PyramidGame.addToLeaderContributionBalance(tokenId, tokenAmount)
          $.id('addContribError').innerHTML = `<span class="blinkSlow">TX Pending.</span> <a href="https://${etherscanLink}/tx/${tx.hash}" target="_blank" rel="nofollow">View on etherscan</a>`
          await tx.wait(1)
          renderPage(addr)
          $.id('addContribError').innerHTML = 'Success!'
          setTimeout(() => {
            $.id('addContribError').innerHTML = ''
          }, 2000)
        } catch (e) {
          $.id('addContribError').innerHTML = e?.data?.message || e?.error?.message || e?.message || 'Something went wrong'
          console.error(e)
        }
      }
    }

    if (erc20Balance > 0) {
      const canClaimLeadership = erc20Balance > lowestLeader.contribution

      if (canClaimLeadership) {
        $.id('claimLeadershipBtn').onclick = async () => {
          $.id('claimError').innerHTML = 'Pending...'
          try {
            const tx = await PyramidGame.claimLeadership()
            $.id('claimError').innerHTML = `<span class="blinkSlow">TX Pending.</span> <a href="https://${etherscanLink}/tx/${tx.hash}" target="_blank" rel="nofollow">View on etherscan</a>`
            await tx.wait(1)
            renderPage(addr)
            $.id('claimError').innerHTML = 'Success!'
            setTimeout(() => {
              $.id('claimError').innerHTML = ''
            }, 2000)
          } catch (e) {
            $.id('claimError').innerHTML = e?.data?.message || e?.error?.message || e?.message || 'Something went wrong'
            console.error(e)
          }
        }
      }

      $.id('transferBtn').onclick = async () => {
        $.id('transferError').innerHTML = 'Pending...'
        try {
          const to = $.id('transferTo').value
          const amount = parseFloat($.id('transferAmount').value)
          const tokenAmount = Math.floor(amount)

          const tx = await PyramidGame.transfer(to, tokenAmount)
          $.id('transferError').innerHTML = `<span class="blinkSlow">TX Pending.</span> <a href="https://${etherscanLink}/tx/${tx.hash}" target="_blank" rel="nofollow">View on etherscan</a>`
          await tx.wait(1)
          renderPage(addr)
          $.id('transferError').innerHTML = 'Success!'
          setTimeout(() => {
            $.id('transferError').innerHTML = ''
          }, 2000)
        } catch (e) {
          $.id('transferError').innerHTML = e?.data?.message || e?.error?.message || e?.message || 'Something went wrong'
          console.error(e)
        }
      }

      $.id('approveBtn').onclick = async () => {
        $.id('approveError').innerHTML = 'Pending...'
        try {
          const spender = $.id('approveSpender').value
          const amount = parseFloat($.id('approveAmount').value)
          const tokenAmount = Math.floor(amount)

          const tx = await PyramidGame.approve(spender, tokenAmount)
          $.id('approveError').innerHTML = `<span class="blinkSlow">TX Pending.</span> <a href="https://${etherscanLink}/tx/${tx.hash}" target="_blank" rel="nofollow">View on etherscan</a>`
        $.id('approveError').innerHTML = 'Success!'
          await tx.wait(1)
          $.id('approveError').innerHTML = ''
          setTimeout(() => $.id('approveError').innerHTML = '', 4000)
        } catch (e) {
          $.id('approveError').innerHTML = e?.data?.message || e?.error?.message || e?.message || 'Something went wrong'
          console.error(e)
        }
      }
    }

    if (pgBalance > 0) {
      $.id('forceDistributeBtn').onclick = async () => {
        $.id('forceDistributeError').innerHTML = 'Pending...'
        try {
          const tx = await PyramidGame.forceDistribution()
          $.id('forceDistributeError').innerHTML = `<span class="blinkSlow">TX Pending.</span> <a href="https://${etherscanLink}/tx/${tx.hash}" target="_blank" rel="nofollow">View on etherscan</a>`
          await tx.wait(1)
          renderPage(addr)
          $.id('forceDistributeError').innerHTML = 'Success!'
          setTimeout(() => {
            $.id('forceDistributeError').innerHTML = ''
          }, 2000)
        } catch (e) {
          $.id('forceDistributeError').innerHTML = e?.data?.message || e?.error?.message || e?.message || 'Something went wrong'
          console.error(e)
        }
      }
    }


    // Fetch and render contribution events
    const contributionEvents = await provider.contractEvents(PyramidGame, 'Contribution', [])
    const recentContributions = contributionEvents.slice(-20) // Last 20, oldest first

    if (recentContributions.length > 0) {
      const contributionRows = await Promise.all(recentContributions.map(async event => {
        const prettySender = await provider.formatAddr(event.sender)
        const amount = ethVal(event.amount)
        const block = await provider.provider.getBlock(event.blockNumber)
        const timeAgoStr = timeAgo(block.timestamp * 1000)
        return `
          <a class="contribution-row" href="https://${etherscanLink}/tx/${event.txHash}" target="_blank" rel="nofollow">
            <span class="address">${prettySender}</span> sent <span class="contribution-amount"><span style="margin-right: 0.25em">Ξ</span>${amount.toFixed(4)}</span> ${timeAgoStr}
          </a>
        `
      }))

      $.id('distributions').innerHTML = `
        <h2>Latest Contributions</h2>
        <div style="max-width: 800px; margin: 1em auto;">
          ${contributionRows.join('')}
        </div>
      `
    } else {
      $.id('distributions').innerHTML = `
        <h2>Latest Contributions</h2>
        <p>No contributions yet</p>
      `
    }

    addEtherscanLinks('scanlink', 'PyramidGame', chainName)
  }

  provider.onConnect(renderPage)



export const setColor = (c, v) => {
  const r = document.querySelector(':root')
  r.style.setProperty(c, v)
}

const colors = [
 'var(--green-color)',
 'var(--black-color)',
 'var(--blue-color)',
 'var(--red-color)',
]//.sort(() => Math.random() - 0.5)


setColor('--bg-color', colors[0])
setColor('--font-color', colors[1])
setColor('--accent-color', colors[2])


// pink/orange

const pyramid = (c1, c2) => {
  console.log(c1, c2)
  return `
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 487 487" fill="none" style="display: inline-block; width: 350px">
      <rect width="100%" height="100%" x="0" y="0" fill="${c2} !important" stroke-width="0"></rect>
      <path d="M465.001 435.5H244.995H20.5L242.75 50L465.001 435.5Z"  stroke-width="14" stroke="${c1} !important"/>
      <path d="M205.5 348C216 357 227.513 359.224 243.001 359.999C293 362.5 301.001 294.999 243.001 293.499C185.001 291.999 196.5 224.5 243.001 229.998C243.001 229.998 259.5 229.998 276.5 244"  stroke-width="14" stroke-linecap="square" stroke="${c1} !important"/>
      <line x1="242.5" y1="201" x2="242.5" y2="386"  stroke-width="14" stroke="${c1} !important"/>
    </svg>
`}







</script>
</html>